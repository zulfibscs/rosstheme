<?php
/**
 * Default Footer Template - Modern Professional
 * Fully dynamic based on Ross Theme options
 */

if (!defined('ABSPATH')) exit;

// Get theme options
$footer_options = get_option('ross_theme_footer_options', array());
$general_options = get_option('ross_theme_general_options', array());

// Footer styling from options
$footer_bg = $footer_options['styling_bg_color'] ?? '#1a1a1a';
$footer_text = $footer_options['text_color'] ?? '#ffffff';
$footer_link = $footer_options['link_color'] ?? '#E5C902';
$footer_heading = $footer_options['heading_color'] ?? '#ffffff';

// Layout options
$footer_columns = $footer_options['footer_columns'] ?? '4';
$footer_width = $footer_options['footer_width'] ?? 'contained';

// Padding options
$pad_top = $footer_options['styling_padding_top'] ?? $footer_options['footer_padding'] ?? '60';
$pad_bottom = $footer_options['styling_padding_bottom'] ?? $footer_options['footer_padding'] ?? '40';
$pad_left = $footer_options['styling_padding_left'] ?? $footer_options['styling_padding_lr'] ?? '20';
$pad_right = $footer_options['styling_padding_right'] ?? $footer_options['styling_padding_lr'] ?? '20';

// Widget areas
$enable_widgets = $footer_options['enable_widgets'] ?? 1;

// Social icons
$enable_social = function_exists('ross_theme_should_show_social_icons') ? ross_theme_should_show_social_icons() : false;

// Copyright options
$show_copyright = function_exists('ross_theme_should_show_copyright') ? ross_theme_should_show_copyright() : true;
$copyright_text = $footer_options['copyright_text'] ?? '&copy; {year} {site_name}. All rights reserved.';
$copyright_bg = $footer_options['copyright_bg_color'] ?? '#111111';
$copyright_text_color = $footer_options['copyright_text_color'] ?? '#ffffff';
$copyright_alignment = $footer_options['copyright_alignment'] ?? 'center';

// Replace placeholders
$copyright_text = str_replace('{year}', date('Y'), $copyright_text);
$copyright_text = str_replace('{site_name}', get_bloginfo('name'), $copyright_text);

// Background gradient
$use_gradient = $footer_options['styling_bg_gradient'] ?? 0;
$gradient_from = $footer_options['styling_bg_gradient_from'] ?? '#1a1a1a';
$gradient_to = $footer_options['styling_bg_gradient_to'] ?? '#2a2a2a';

// Calculate background
$footer_background = $use_gradient 
    ? "linear-gradient(135deg, {$gradient_from} 0%, {$gradient_to} 100%)"
    : $footer_bg;

// Background image
$bg_image = $footer_options['styling_bg_image'] ?? '';
$bg_style = $bg_image ? "background-image: url('" . esc_url($bg_image) . "'); background-size: cover; background-position: center;" : '';

$container_class = $footer_width === 'full' ? 'container-fluid' : 'container';
?>

<footer class="site-footer ross-footer-default" 
        style="background: <?php echo esc_attr($footer_background); ?>; color: <?php echo esc_attr($footer_text); ?>; padding: <?php echo esc_attr($pad_top); ?>px <?php echo esc_attr($pad_right); ?>px <?php echo esc_attr($pad_bottom); ?>px <?php echo esc_attr($pad_left); ?>px; <?php echo $bg_style; ?>">
    
    <?php if ($bg_image): ?>
    <div class="ross-footer-overlay"></div>
    <?php endif; ?>
    
    <div class="ross-footer-container <?php echo esc_attr($container_class); ?>">
        
        <?php if ($enable_widgets): ?>
        <!-- Footer Widgets -->
        <div class="ross-footer-widgets">
            <div class="ross-footer-columns ross-footer-columns-<?php echo esc_attr($footer_columns); ?>">
                
                <?php
                // Dynamic widget areas based on column count
                $columns = max(1, min(4, intval($footer_columns)));
                for ($i = 1; $i <= $columns; $i++):
                    $sidebar_id = 'footer-' . $i;
                ?>
                <div class="ross-footer-column">
                    <?php if (is_active_sidebar($sidebar_id)): ?>
                        <?php dynamic_sidebar($sidebar_id); ?>
                    <?php else: ?>
                        <div class="footer-placeholder">
                            <!-- Footer Column <?php echo esc_html($i); ?> -->
                            <p style="opacity: 0.6;">Add widgets to Footer <?php echo esc_html($i); ?> in <a href="<?php echo admin_url('widgets.php'); ?>">Appearance â†’ Widgets</a></p>
                        </div>
                    <?php endif; ?>
                </div>
                <?php endfor; ?>
                
            </div>
        </div>
        <?php endif; ?>
        
        <?php if ($enable_social): ?>
        <!-- Social Icons -->
        <div class="ross-footer-social">
            <?php
            // Get social links from footer options
            $social_platforms = array(
                'facebook' => $footer_options['social_facebook'] ?? '',
                'twitter' => $footer_options['social_twitter'] ?? '',
                'instagram' => $footer_options['social_instagram'] ?? '',
                'linkedin' => $footer_options['social_linkedin'] ?? '',
                'youtube' => $footer_options['social_youtube'] ?? '',
                'pinterest' => $footer_options['social_pinterest'] ?? '',
            );
            
            foreach ($social_platforms as $platform => $url):
                if (!empty($url)):
        ?>
        <a href="<?php echo esc_url($url); ?>" target="_blank" rel="noopener noreferrer" 
           class="ross-social-link ross-social-<?php echo esc_attr($platform); ?>"
           aria-label="<?php echo esc_attr(ucfirst($platform)); ?>"
           style="color: <?php echo esc_attr($footer_link); ?>;">
            <i class="fab fa-<?php echo esc_attr($platform); ?>"></i>
        </a>
        <?php
                endif;
            endforeach;
        ?>
        </div>
        <?php endif; ?>
        
        <?php
        // Custom footer HTML (site-wide) if enabled
        if (function_exists('ross_theme_render_custom_footer')) {
            ross_theme_render_custom_footer();
        }
        ?>
                            <?php if (!empty($footer_options['linkedin_url'])): ?>
                                <a href="<?php echo esc_url($footer_options['linkedin_url']); ?>" target="_blank" class="social-icon">LinkedIn</a>
                            <?php endif; ?>
                        </div>
                    <?php endif; ?>
                <?php endif; ?>
            </div>
        </div>
    </div>
    <?php endif; ?>
    <?php if (!empty($footer_options['custom_footer_js'])): ?>
        <script><?php echo esc_html($footer_options['custom_footer_js']); ?></script>
    <?php endif; ?>
</footer>